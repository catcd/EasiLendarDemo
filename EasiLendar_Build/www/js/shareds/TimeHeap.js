angular.module("MainApp.shareds.timeHeap",[]).run(function($rootScope){$rootScope.newTimeNode=function(mStart,mEnd){return new TimeNode(mStart,mEnd)};$rootScope.maxNode=function(array){if(array.length==0){console.log("Array is empty");maxNode=null}else{var maxNode=new TimeNode(array[array.length-1].start,array[array.length-1].end);var maxScore=maxNode.getScore();for(var i=array.length-2;i>=0;i--){var node=new TimeNode(array[i].start,array[i].end);if(node.getScore()>maxScore){maxScore=node.getScore();maxNode=node}}}return maxNode};$rootScope.newTimeHeap=function(){return new TimeHeap};function TimeNode(mStart,mEnd){var scoreArray=[{start:0,end:359,pts:$rootScope.calPoint(0)},{start:360,end:479,pts:$rootScope.calPoint(6)},{start:480,end:659,pts:$rootScope.calPoint(8)},{start:660,end:839,pts:$rootScope.calPoint(11)},{start:840,end:1019,pts:$rootScope.calPoint(14)},{start:1020,end:1199,pts:$rootScope.calPoint(17)},{start:1200,end:1439,pts:$rootScope.calPoint(20)}];var rateScore=function(start,end){var sumPts=0;var toDay=new Date;toDay=new Date(toDay.setHours(0,0,0,0));var startTime=start.getHours()*60+start.getMinutes();var endTime=end.getHours()*60+end.getMinutes();if(endTime==0&&end>start)endTime=1440;var d=angular.copy(start);if(new Date(d.setHours(0,0,0,0))>toDay)sumPts=sumPts-(end-start)/1E3/60;if(start==end)sumPts+=0;if(start<end)if(startTime==0&&endTime>=1439)sumPts+=119*$rootScope.calPoint(6)+179*$rootScope.calPoint(8)+179*$rootScope.calPoint(11)+179*$rootScope.calPoint(14)+179*$rootScope.calPoint(17)+239*$rootScope.calPoint(20);else for(var i=0;i<scoreArray.length;i++)if(startTime>scoreArray[i].end||endTime<scoreArray[i].start)continue;else if(i==0)sumPts+=0;else{sumPts=sumPts+((endTime<scoreArray[i].end?endTime:scoreArray[i].end)-(startTime>scoreArray[i].start?startTime:scoreArray[i].start))*scoreArray[i].pts;if(endTime==scoreArray[i].end)sumPts=sumPts-scoreArray[i].pts;if(endTime==scoreArray[i].end+1)sumPts=sumPts+scoreArray[i].pts}return sumPts};this.start=mStart;this.end=mEnd;this.score=rateScore(mStart,mEnd);this.getStart=function(){return this.start};this.getEnd=function(){return this.end};this.getScore=function(){return this.score};this.setStart=function(startTime){this.start=startTime};this.setEnd=function(endTime){this.end=endTime};this.setScore=function(score){this.score=score}}function TimeHeap(){this.timeList=new Array;this.length=0;this.cache=null;this.push=function(item){if(item!==null){this.length++;this.timeList[this.length-1]=item;var i=this.length-1;var j=(i-(i%2==0?2:1))/2;while(j>=0){if(this.timeList[i].getScore()>this.timeList[j].getScore()){var term=angular.copy(this.timeList[i]);this.timeList[i]=angular.copy(this.timeList[j]);this.timeList[j]=angular.copy(term)}i=j;j=(i-(i%2==0?2:1))/2}this.cache=angular.copy(this.timeList)}};this.pop=function(){var top=angular.copy(this.timeList[0]);this.timeList[0]=angular.copy(this.timeList[this.length-1]);this.timeList.splice(this.length-1,1);this.length--;if(this.length>0){var i=0;var j=0;while(this.timeList[j+1]!==undefined&&this.timeList[j+2]!==undefined){if(this.timeList[j+1]!==undefined&&this.timeList[j+2]==undefined)j+=1;else if(this.timeList[j+2]!==undefined&&this.timeList[j+1]==undefined)j+=2;else j+=this.timeList[j+1].getScore()>this.timeList[j+2].getScore()?1:2;if(this.timeList[i].getScore()<this.timeList[j].getScore()){var term=angular.copy(this.timeList[i]);this.timeList[i]=angular.copy(this.timeList[j]);this.timeList[j]=angular.copy(term)}i=j;j=2*i}}return top};this.backUp=function(){this.timeList=angular.copy(this.cache)};this.getLength=function(){return this.length};this.getTop=function(){return this.timeList[0]}}});