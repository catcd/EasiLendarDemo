var easilendar=angular.module('MainApp.shareds.easiLendarClass',[]);easilendar.run(function($rootScope){$rootScope.eventColor=["#09c","#0cf","#36f","#93f","#ff9999","#fc0","#f60","#0c6","#666","#99f","#393","#c30"];$rootScope.newDay=function(date){return new Day(date);};$rootScope.newWeekCalendar=function(){return new WeekCalendar();};$rootScope.newWeek=function(days,start){return new Week(days,start);};$rootScope.newTime=function(time){return new Time(time);};$rootScope.newEvent=function(event){return new Event(event);};$rootScope.newBusyEvent=function(start,end){return new BusyEvent(start,end);}
function Time(time){var toMinute=function(){if(time!=null){var hour=time.getHours();var min=time.getMinutes();return hour*60+min;}else{return null;}};this.minutes=toMinute();};var isNormal=function(start,end){var startDate=start.dateTime.getDate();var endDate=end.dateTime.getDate();var startMonth=start.dateTime.getMonth();var endMonth=end.dateTime.getMonth();var startYear=start.dateTime.getFullYear();var endYear=end.dateTime.getFullYear();if(startDate!=endDate||startMonth!=endMonth||startYear!=endYear||(end.dateTime.getHours()==23&&end.dateTime.getMinutes()==59)){return false;}
return true;};function BusyEvent(start,end){this.setStart=function(){if(start!=null&&isNormal(start,end))
return start;return null;};this.setEnd=function(){if(end!=null&&isNormal(start,end))
return end;return null;};this.start=this.setStart();this.end=this.setEnd();this.summary="Busy";this.colorId=8;};function Event(event){this.origin=event;var setType=function(){if(event!=null){var startDate=event.start.dateTime.getDate();var endDate=event.end.dateTime.getDate();var startHour=event.start.dateTime.getHours();var startMin=event.start.dateTime.getMinutes();var startSec=event.start.dateTime.getSeconds();var endHour=event.end.dateTime.getHours();var endMin=event.end.dateTime.getMinutes();var endSec=event.end.dateTime.getSeconds();if(startDate==endDate&&startHour==0&&startMin==0&&startSec==0&&endHour==23&&endMin==59&&endSec==59){return"all";}
else if(!isNormal(event.start,event.end)){return"over";}
else{return"normal";}}else return null;};var setColor=function(){if(event.colorId==null){return $rootScope.eventColor[0];}else{return $rootScope.eventColor[event.colorId];}};this.type=setType();this.color=setColor();};function Day(date){this.year=date.getFullYear();this.month=date.getMonth();this.date=date.getDate();this.day=$rootScope.weekDays[(date.getDay()+6)%7];var setEvents=function(){var calendar;switch($rootScope.currentState){case'week':calendar=$rootScope.eUser.uGmailCalendar;break;case'profile':if($rootScope.eFriend.fMultiCal!=null){calendar=$rootScope.eFriend.fMultiCal.calendar;}else calendar=null;break;case'result':calendar=$rootScope.resultMultiCalendar.calendar;break;};if(calendar==null)return null;if(calendar[date]==null)return null;var events=[];for(var i=0;i<calendar[date].length;i++){events[i]=new Event(calendar[date][i]);}
return events;};this.events=setEvents();this.nextDay=function(){var date=this.date+1;var month=this.month;var year=this.year;return new Day(new Date(year,month,date));};this.prevDay=function(){var date=this.date-1;var month=this.month;var year=this.year;return new Day(new Date(year,month,date));};this.toDate=function(){return new Date(this.year,this.month,this.date);};};function Week(days,start){var setStart=function(){if(days!=null){return days[0].day;}else if(start!=null){return start;}else{return"Mon";}};var setDays=function(){if(days==null){var date=new Date();var curdays=[];var pos;switch(start){case"Sat":pos=(date.getDay()+1)%7;break;case"Sun":pos=date.getDay();break;default:pos=(date.getDay()+6)%7;break;};curdays[pos]=new Day(new Date(date.getFullYear(),date.getMonth(),date.getDate()));for(var i=pos;i<6;i++){curdays[i+1]=curdays[i].nextDay();}
for(var i=pos;i>0;i--){curdays[i-1]=curdays[i].prevDay();}
return curdays;}else{return days;}};this.start=setStart();this.days=setDays();this.month1=this.days[0].month;this.month2=this.days[6].month;this.year1=this.days[0].year;this.year2=this.days[6].year;this.nextWeek=function(){var tdays=[];tdays[0]=this.days[6].nextDay();for(var i=0;i<6;i++){tdays[i+1]=tdays[i].nextDay();}
return new Week(tdays);};this.prevWeek=function(){var tdays=[];tdays[6]=this.days[0].prevDay();for(var i=6;i>0;i--){tdays[i-1]=tdays[i].prevDay();}
return new Week(tdays);};};function WeekCalendar(){var setHours=function(){var hours=[];for(var i=0;i<24;i++){if(i==0){hours[i]="12AM";}else if(i<12){hours[i]=i+"AM";}else if(i==12){hours[i]=i+"PM";}else{hours[i]=(i-12)+"PM";}}
return hours;};var setNavMonth=function(month1,month2){if(month1==month2){return $rootScope.months[month1];}else{return $rootScope.months[month1]+"-"+$rootScope.months[month2];}};var setNavYear=function(year1,year2){if(year1==year2){return year1;}else{return year1+"-"+year2;}};this.setNavDays=function(){for(var i=0;i<7;i++){this.navDays[i]=new WeekDay(this.navDays[i]);}
for(var i=0;i<7;i++){if(this.navDays[i].events!=null){var length=this.navDays[i].events.length;for(var j=0;j<length;j++){if(this.navDays[i].events[j].event.type=="over"){var dur=this.navDays[i].events[j].duration;for(var k=i+1;k<i+dur;k++){if(this.navDays[k].events!=null&&this.navDays[k].events[j]!=null){for(var t=length;t>j;t--){this.navDays[k].events[t]=this.navDays[k].events[t-1];}
this.navDays[k].events[j]=new EmptyEvent(this.navDays[i].events[j]);}else if(this.navDays[k].events!=null){var kLength=this.navDays[k].events.length;for(var t=kLength;t<=j;t++){this.navDays[k].events[t]=new EmptyEvent(this.navDays[i].events[j]);}}else{this.navDays[k].events=[];for(var t=0;t<=j;t++){this.navDays[k].events[t]=new EmptyEvent(this.navDays[i].events[j]);}}}}}}}
this.setContentHeight();};this.setNavTime=function(week){this.navWeek=week;this.navDays=angular.copy(week.days);this.setNavDays();this.navMonth=setNavMonth(week.month1,week.month2);this.navYear=setNavYear(week.year1,week.year2)
this.navBackground="easi-"+$rootScope.shortMonths[week.month2]+"-bkg";};this.hours=setHours();this.curWeek=$rootScope.newWeek(null,$rootScope.eSettings.sFirstDay.slice(0,3));this.curMonth1=this.curWeek.month1;this.curMonth2=this.curWeek.month2;this.curYear1=this.curWeek.year1;this.curYear2=this.curWeek.year2;this.navDays=angular.copy(this.curWeek.days);this.navWeek=this.curWeek;this.navMonth=setNavMonth(this.curWeek.month1,this.curWeek.month2);this.navYear=setNavYear(this.curWeek.year1,this.curWeek.year2)
this.navBackground="easi-"+$rootScope.shortMonths[this.curWeek.month2]+"-bkg";this.contentHeight={"height":"80%",};this.setContentHeight=function(){var max=0;for(var i=0;i<7;i++){if(this.navDays[i].events!=null){if(this.navDays[i].events.length>max){max=this.navDays[i].events.length;}}}
var height=25+30+max*22;this.contentHeight={"height":'calc(100% - '+height+'px)',}};this.nextWeek=function(){this.setNavTime(this.navWeek.nextWeek());};this.prevWeek=function(){this.setNavTime(this.navWeek.prevWeek());};};function WeekDay(day){this.origin=day;this.setEvent=function(type){if(this.origin!=null&&this.origin.events!=null){var event=[];var j=0;if(type==null){for(var i=0;i<this.origin.events.length;i++){switch(this.origin.events[i].type){case"all":event[j++]=new AllEvent(this.origin.events[i]);break;case"over":var start=this.origin.events[i].origin.start.dateTime;var date=this.origin.date;var year=this.origin.year;var month=this.origin.month;if(start.getFullYear()==year&&start.getMonth()==month&&start.getDate()==date||this.origin.day==$rootScope.eSettings.sFirstDay.slice(0,3))
{event[j++]=new OverEvent(this.origin.events[i],this.origin);}}}}else{for(var i=0;i<this.origin.events.length;i++){if(this.origin.events[i].type==type){event[j++]=new NorEvent(this.origin.events[i]);}}}
if(j==0)return null;return event;}else return null;};this.events=this.setEvent();this.norEvent=this.setEvent("normal");};function NorEvent(event){this.event=event;this.start=$rootScope.newTime(event.origin.start.dateTime);this.end=$rootScope.newTime(event.origin.end.dateTime);this.durationToPx=function(){var dur=this.end.minutes-this.start.minutes;if(parseInt(dur/12*8)>20)
return parseInt(dur/12*8)+"px";else return 20+"px";};this.startToPx=function(){var min=this.start.minutes;return parseInt(min/12*8)+"px";};this.height=this.durationToPx();this.margin=this.startToPx();this.style={"height":this.height,"margin-top":this.margin,"background-color":this.event.color,};};function AllEvent(event){this.event=event;this.style={"background-color":this.event.color,'width':'100%','height':'20px','color':'white','text-align':'left','margin-top':'2px','font-size':'15px','overflow':'hidden','position':'relative','z-index':'1',};};function OverEvent(event,date){this.event=event;this.setWidth=function(){var startDate=date.toDate();var endDate=event.origin.end.dateTime;var duration=endDate.getDate()-startDate.getDate()+1;var startDay=(startDate.getDay()+6)%7;var startOfWeek=$rootScope.eSettings.sFirstDay.slice(0,3);var endOfWeek=6;switch(startOfWeek){case"Mon":break;case"Sat":startDay=(startDay+2)%7;break;case"Sun":startDay=(startDay+1)%7;break;};var tempDuration=endOfWeek-startDay+1;if(duration>=tempDuration){return tempDuration*100;}else{return duration*100;}};this.duration=this.setWidth()/ 100;this.width=(this.setWidth()+3)+"%";this.style={"width":this.width,"background-color":this.event.color,'height':'20px','font-size':'15px','color':'white','overflow':'hidden','text-align':'left','margin-top':'2px','position':'relative','z-index':'1',};};function EmptyEvent(event){var set=function(){var temp=angular.copy(event.event);temp.origin.summary=null;return temp;};this.event=set();this.style={"height":"20px","width":"90%","margin-top":"2px",'position':'relative','z-index':'1',};};});