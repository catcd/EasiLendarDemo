var result=angular.module('MainApp.controllers.result',[]);result.controller("ResultController",function($rootScope,$scope,$ionicPopup,$state){var link=$rootScope.eSettings.sDefaultView;$scope.done=function(){$rootScope.eFriend.fMultiCal=null;$rootScope.goToState(link)};if($rootScope.eFriend.fMultiCal!=null){$rootScope.resultMultiCalendar=$rootScope.newMultiCal([$rootScope.eUser.uGmailCalendar,$rootScope.eFriend.fMultiCal.calendar])}else{$rootScope.resultMultiCalendar=$rootScope.newMultiCal([$rootScope.eUser.uGmailCalendar])}$scope.weekCalendar=$rootScope.newWeekCalendar();$scope.weekCalendar.setNavDays();var date=new Date();$scope.navStart=new Date(date.getFullYear(),date.getMonth(),date.getDate());$scope.navEnd=$scope.weekCalendar.navDays[6].origin.toDate();$scope.mHeap=$rootScope.evaluateTime($rootScope.resultMultiCalendar,$scope.navStart,$scope.navEnd,$rootScope.eSearchFilter.mDuration);$scope.options={list:[],add:function(mHeap){this.list=[];if(mHeap!=null){var num=mHeap.timeList.length;if(num>5)num=5;for(var i=0;i<num;i++){var max=mHeap.pop();var option=new Option(max.start,max.end);this.list.push(option)}}},selectOption:function(option){$scope.showAlert('Your meeting time: '+option.display())},next:function(){$scope.weekCalendar.nextWeek();if($scope.weekCalendar.navDays[0].origin.toDate()>=new Date()){$scope.navStart=$scope.weekCalendar.navDays[0].origin.toDate();$scope.navEnd=$scope.weekCalendar.navDays[6].origin.toDate();$scope.mHeap=$scope.evaluateTime($rootScope.resultMultiCalendar,$scope.navStart,$scope.navEnd,$rootScope.eSearchFilter.mDuration)}else if($scope.weekCalendar.navDays[6].origin.toDate()>new Date()){var date=new Date();$scope.navStart=new Date(date.getFullYear(),date.getMonth(),date.getDate());$scope.navEnd=$scope.weekCalendar.navDays[6].origin.toDate();$scope.mHeap=$rootScope.evaluateTime($scope.resultMultiCalendar,$scope.navStart,$scope.navEnd,$rootScope.eSearchFilter.mDuration)}else{$scope.mHeap=null}this.add($scope.mHeap)},prev:function(){$scope.weekCalendar.prevWeek();if($scope.weekCalendar.navDays[0].origin.toDate()>=new Date()){$scope.navStart=$scope.weekCalendar.navDays[0].origin.toDate();$scope.navEnd=$scope.weekCalendar.navDays[6].origin.toDate();$scope.mHeap=$scope.evaluateTime($rootScope.resultMultiCalendar,$scope.navStart,$scope.navEnd,$rootScope.eSearchFilter.mDuration)}else if($scope.weekCalendar.navDays[6].origin.toDate()>new Date()){var date=new Date();$scope.navStart=new Date(date.getFullYear(),date.getMonth(),date.getDate());$scope.navEnd=$scope.weekCalendar.navDays[6].origin.toDate();$scope.mHeap=$rootScope.evaluateTime($rootScope.resultMultiCalendar,$scope.navStart,$scope.navEnd,$rootScope.eSearchFilter.mDuration)}else{$scope.mHeap=null}this.add($scope.mHeap)},};$scope.options.add($scope.mHeap);$scope.$watch('eFriend.fMultiCal',function(){if($rootScope.eFriend.fMultiCal!=null){$rootScope.resultMultiCalendar=$rootScope.newMultiCal([$rootScope.eUser.uGmailCalendar,$rootScope.eFriend.fMultiCal.calendar])}else{$rootScope.resultMultiCalendar=$rootScope.newMultiCal([$rootScope.eUser.uGmailCalendar])}$scope.weekCalendar=$rootScope.newWeekCalendar();$scope.weekCalendar.setNavDays();var date=new Date();$scope.navStart=new Date(date.getFullYear(),date.getMonth(),date.getDate());$scope.navEnd=$scope.weekCalendar.navDays[6].origin.toDate();$scope.mHeap=$rootScope.evaluateTime($rootScope.resultMultiCalendar,$scope.navStart,$scope.navEnd,$rootScope.eSearchFilter.mDuration);$scope.options.add($scope.mHeap)});$scope.$watch('eSearchFilter.mDuration',function(){if($rootScope.eFriend.fMultiCal!=null){$rootScope.resultMultiCalendar=$rootScope.newMultiCal([$rootScope.eUser.uGmailCalendar,$rootScope.eFriend.fMultiCal.calendar])}else{$rootScope.resultMultiCalendar=$rootScope.newMultiCal([$rootScope.eUser.uGmailCalendar])}var date=new Date();$scope.navStart=new Date(date.getFullYear(),date.getMonth(),date.getDate());$scope.navEnd=$scope.weekCalendar.navDays[6].origin.toDate();$scope.mHeap=$rootScope.evaluateTime($rootScope.resultMultiCalendar,$scope.navStart,$scope.navEnd,$rootScope.eSearchFilter.mDuration);$scope.options.add($scope.mHeap)});function Option(start,end){var convertDate=function(date){var year=date.getFullYear();var month=date.getMonth();var day=date.getDate();if(day<10)day="0"+day;if(month+1<10)month="0"+(month+1);return day+'/'+month+'/'+year};var convertTime=function(time){var hour=time.getHours();var min=time.getMinutes();if(hour<10)hour="0"+hour;if(min<10)min="0"+min;return hour+":"+min};this.date1=convertDate(start);this.date2=convertDate(end);this.from=convertTime(start);this.to=convertTime(end);this.display=function(){if(this.date1==this.date2){return this.date1+": from "+this.from+" - to "+this.to}else if(this.from!="00:00"){return this.date1+": from "+this.from+" - to Midnight"}else{return this.date1+": Any time"}}}});
